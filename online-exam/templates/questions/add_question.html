{% extends 'base.html' %}
{% block title %}Create New Question{% endblock %}
{% load static %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<style>
body {
    font-family: "Poppins", sans-serif;
    background-color: #f8f9fa;
    overflow-x: hidden;
}

/* Main Wrapper */
.add-question-container {
    max-width: 1200px;
    margin: 40px auto;
    background: #ffffff;
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

/* Heading */
.add-question-container h2 {
    font-weight: 700;
    color: #007bff;
    border-bottom: 3px solid #007bff;
    display: inline-block;
    padding-bottom: 6px;
    margin-bottom: 25px;
}

/* Form Layout */
.form-group label {
    font-weight: 500;
    margin-bottom: 5px;
    color: #333;
}

.option-group {
    margin-top: 15px;
}

.option-group input {
    margin-bottom: 8px;
}

/* Row layout for subject-topic */
.subject-topic-row {
    display: flex;
    gap: 15px;
}

/* Submit button */
.btn-submit {
    background-color: #007bff;
    color: white;
    font-weight: 600;
    padding: 12px 30px;
    border: none;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.btn-submit:hover {
    background-color: #005fcc;
    box-shadow: 0 0 0 5px #007bff44;
}

/* Tab styling */
.nav-tabs {
    border: none;
    margin-bottom: 25px;
}

.nav-tabs .nav-link {
    border: none;
    border-radius: 10px;
    background-color: #007bff;
    color: #fff;
    margin-right: 10px;
    padding: 10px 25px;
    transition: 0.3s;
}

.nav-tabs .nav-link:hover,
.nav-tabs .nav-link.active {
    background-color: #005fcc;
}
#multipleChoiceOptions {
    display: none; /* hidden by default */
    background: #f8faff;
    padding: 20px;
    border-radius: 10px;
    border: 1px solid #dee2e6;
    margin-top: 15px;
}

#multipleChoiceOptions label {
    font-weight: 600;
    color: #005fcc;
    display: block;
    margin-bottom: 10px;
}

.option-group .input-group {
    background: #fff;
    border: 1px solid #ced4da;
    border-radius: 8px;
    padding: 6px;
    display: flex;
    gap: 10px;
    align-items: center;
}

.option-group .input-group input[type="text"] {
    flex: 1;
    border: none;
    outline: none;
    background: transparent;
    font-size: 14px;
}

.option-group .input-group input[type="file"] {
    flex: 0 0 150px;
}

.option-group .input-group:hover {
    border-color: #007bff;
    box-shadow: 0 0 5px #007bff33;
}

#multipleChoiceOptions select {
    margin-top: 10px;
    width: 220px;
}


</style>

<div class="add-question-container">
    <h2>Create a New Question</h2>

    <!-- Tabs for manual / file upload -->
    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#manualInput">Create Manually</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#fileUpload">Upload File</a>
        </li>
    </ul>

    <div class="tab-content">
        <!-- File Upload Tab -->
        <div id="fileUpload" class="tab-pane fade">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group mb-3">
                    <label>Upload Question File</label>
                    <input type="file" class="form-control" name="question_file" accept=".pdf,.doc,.docx,.txt">
                    <small class="text-muted">Supported: PDF, Word, or Text</small>
                </div>

                <div class="form-group mb-3">
                    <label>File Type</label>
                    <select class="form-control" name="file_type">
                        <option value="structured">Structured Question Paper</option>
                        <option value="unstructured">Unstructured Text</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-submit">Upload and Process</button>
            </form>
        </div>

        <!-- Manual Question Creation -->
        <div id="manualInput" class="tab-pane fade show active">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Question Type -->
                <div class="form-group mb-3">
                    <label>Question Type</label>
                    <select name="question_type" id="questionType" class="form-control" onchange="toggleAnswerFields()" required>
                        <option value="">Select Type</option>
                        <option value="multiple_choice">Multiple Choice</option>
                        <option value="true_false">True/False</option>
                        <option value="short_answer">Short Answer</option>
                        <option value="essay">Essay</option>
                        <option value="fill_blanks">Fill in the Blanks</option>
                        <option value="matching">Matching</option>
                        <option value="numerical">Numerical</option>
                    </select>
                </div>

                <!-- Question Text -->
                <div class="form-group mb-3">
                    <label>Question Text</label>
                    <textarea name="question_text" class="form-control" rows="5" placeholder="Enter the question here..." required></textarea>
                </div>

                <!-- Upload Image/File -->
                <div class="form-group mb-3">
                    <label>Upload Supporting File (Optional)</label>
                    <input type="file" name="question_file" class="form-control" accept=".jpg,.png,.pdf,.docx,.txt">
                </div>

                <!-- Subject & Topic -->
                <div class="subject-topic-row mb-3">
                    <div class="flex-fill">
                        <label>Subject</label>
                        <input type="text" name="subject" class="form-control" placeholder="Enter subject" required>
                    </div>
                    <div class="flex-fill">
                        <label>Topic</label>
                        <input type="text" name="topic" class="form-control" placeholder="Enter topic" required>
                    </div>
                </div>

                <!-- Options / Dynamic Fields -->
                <div id="multipleChoiceOptions" style="display:none;">
                    <label>Options:</label>
                    <div class="option-group">
                        {% for i in "1234" %}
                        <div class="input-group mb-2">
                            <input type="text" name="option{{ i }}" class="form-control" placeholder="Option {{ i }}">
                            <input type="file" name="option{{ i }}_image" class="form-control" accept="image/*">
                        </div>
                        {% endfor %}
                    </div>
                    <label>Correct Answer</label>
                    <select name="correct_answer" class="form-control">
                        <option value="1">Option 1</option>
                        <option value="2">Option 2</option>
                        <option value="3">Option 3</option>
                        <option value="4">Option 4</option>
                    </select>
                </div>

                <div id="trueFalseOptions" style="display:none;" class="mb-3">
                    <label>Correct Answer</label>
                    <select name="tf_answer" class="form-control">
                        <option value="true">True</option>
                        <option value="false">False</option>
                    </select>
                </div>

                <div id="fillBlanksOptions" style="display:none;" class="mb-3">
                    <label>Correct Answer(s)</label>
                    <input type="text" name="blank_answer" class="form-control" placeholder="Separate multiple answers with ;">
                </div>

                <div id="matchingOptions" style="display:none;" class="mb-3">
                    <label>Matching Pairs</label>
                    <div id="matchingPairs">
                        <div class="input-group mb-2">
                            <input type="text" name="match_left[]" class="form-control" placeholder="Left item">
                            <input type="text" name="match_right[]" class="form-control" placeholder="Right item">
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addMatchingPair()">+ Add More</button>
                </div>

                <div id="numericalOptions" style="display:none;" class="mb-3">
                    <label>Correct Answer</label>
                    <input type="number" name="numerical_answer" class="form-control" step="any">
                    <label class="mt-2">Acceptable Error Margin (Â±)</label>
                    <input type="number" name="error_margin" class="form-control" step="any" placeholder="e.g., 0.1">
                </div>

                <div id="shortAnswerOptions" style="display:none;" class="mb-3">
                    <label>Model Answer</label>
                    <textarea name="short_answer" class="form-control" rows="3"></textarea>
                </div>

                <div id="essayOptions" style="display:none;" class="mb-3">
                    <label>Grading Rubric</label>
                    <textarea name="essay_rubric" class="form-control" rows="3" placeholder="Enter grading criteria"></textarea>
                    <label class="mt-2">Word Limit</label>
                    <input type="number" name="word_limit" class="form-control" placeholder="Max word count">
                </div>

                <!-- Difficulty -->
                <div class="form-group mb-4">
                    <label>Difficulty Level</label>
                    <select name="difficulty" class="form-control" required>
                        <option value="">Select Difficulty</option>
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>

                <!-- Submit -->
                <button type="submit" class="btn btn-submit">Submit Question</button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>

function toggleAnswerFields() {
    const type = document.getElementById('questionType').value;
    const sections = ['multipleChoiceOptions','trueFalseOptions','fillBlanksOptions','matchingOptions','numericalOptions','shortAnswerOptions','essayOptions'];

    sections.forEach(id => document.getElementById(id).style.display = 'none');

    if (!type) return;

    // show selected type
    const selectedDiv = document.getElementById(type === 'multiple_choice' ? 'multipleChoiceOptions' :
        type === 'true_false' ? 'trueFalseOptions' :
        type === 'fill_blanks' ? 'fillBlanksOptions' :
        type === 'matching' ? 'matchingOptions' :
        type === 'numerical' ? 'numericalOptions' :
        type === 'short_answer' ? 'shortAnswerOptions' :
        type === 'essay' ? 'essayOptions' : ''
    );

    if (selectedDiv) selectedDiv.style.display = 'block';
}
{% endblock %}