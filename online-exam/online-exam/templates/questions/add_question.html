{% extends 'base.html' %}
{% block title %}Add Question{% endblock %}

{% block extra_head %}
<!-- Remove this line -->
<!-- <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Add Question</h2>
    
    <!-- Question Input Method Selector -->
    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#manualInput">Create Question</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#fileUpload">Upload File</a>
        </li>
    </ul>

    <div class="tab-content">
        <!-- File Upload Tab -->
        <div id="fileUpload" class="tab-pane fade">
            <form method="POST" enctype="multipart/form-data" class="question-form">
                {% csrf_token %}
                <div class="mb-3">
                    <label class="form-label">Upload Question File</label>
                    <input type="file" class="form-control" name="question_file" accept=".pdf,.doc,.docx,.txt">
                    <small class="text-muted">Supported formats: PDF, Word, Text</small>
                </div>
                <div class="mb-3">
                    <label class="form-label">File Type</label>
                    <select class="form-control" name="file_type">
                        <option value="structured">Structured Question Paper</option>
                        <option value="unstructured">Unstructured Text</option>
                    </select>
                </div>
                <button type="submit" name="upload_file" class="btn btn-primary">Upload and Process</button>
            </form>
        </div>

        <!-- Manual Input Tab -->
        <div id="manualInput" class="tab-pane fade show active">
            <form method="POST" class="question-form" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group mb-3">
                    <label for="questionType">Question Type:</label>
                    <select name="question_type" id="questionType" class="form-control" onchange="toggleAnswerFields()" required>
                        <option value="">Select Question Type</option>
                        <option value="multiple_choice">Multiple Choice</option>
                        <option value="true_false">True/False</option>
                        <option value="short_answer">Short Answer</option>
                        <option value="essay">Essay</option>
                        <option value="fill_blanks">Fill in the Blanks</option>
                        <option value="matching">Matching</option>
                        <option value="numerical">Numerical</option>
                    </select>
                </div>
    
                <div class="form-group mb-3">
                    <label for="questionText">Question Text:</label>
                    <textarea name="question_text" id="questionText" class="form-control" rows="5" required></textarea>
                </div>
                <!-- Remove the file upload div that was here -->
                
                <!-- Multiple Choice Options -->
                <div id="multipleChoiceOptions" style="display: none;" class="mb-3">
                    <div class="form-group">
                        <label>Options:</label>
                        <div class="option-group">
                            <div class="input-group mb-2">
                                <input type="text" name="option1" class="form-control" placeholder="Option 1">
                                <input type="file" name="option1_image" class="form-control" accept="image/*">
                            </div>
                            <div class="input-group mb-2">
                                <input type="text" name="option2" class="form-control" placeholder="Option 2">
                                <input type="file" name="option2_image" class="form-control" accept="image/*">
                            </div>
                            <div class="input-group mb-2">
                                <input type="text" name="option3" class="form-control" placeholder="Option 3">
                                <input type="file" name="option3_image" class="form-control" accept="image/*">
                            </div>
                            <div class="input-group mb-2">
                                <input type="text" name="option4" class="form-control" placeholder="Option 4">
                                <input type="file" name="option4_image" class="form-control" accept="image/*">
                            </div>
                        </div>
                        <label>Correct Answer:</label>
                        <select name="correct_answer" class="form-control">
                            <option value="1">Option 1</option>
                            <option value="2">Option 2</option>
                            <option value="3">Option 3</option>
                            <option value="4">Option 4</option>
                        </select>
                    </div>
                </div>
    
                <!-- True/False Options -->
                <div id="trueFalseOptions" style="display: none;" class="mb-3">
                    <div class="form-group">
                        <label>Correct Answer:</label>
                        <select name="tf_answer" class="form-control">
                            <option value="true">True</option>
                            <option value="false">False</option>
                        </select>
                    </div>
                </div>
    
                <!-- Fill in the Blanks Options -->
                <div id="fillBlanksOptions" style="display: none;" class="mb-3">
                    <div class="form-group">
                        <label>Correct Answer(s):</label>
                        <input type="text" name="blank_answer" class="form-control" placeholder="Enter the correct answer">
                        <small class="text-muted">For multiple possible answers, separate them with semicolons (;)</small>
                    </div>
                </div>
    
                <!-- Matching Options -->
                <div id="matchingOptions" style="display: none;" class="mb-3">
                    <div class="form-group">
                        <div id="matchingPairs">
                            <div class="matching-pair input-group mb-2">
                                <input type="text" name="match_left[]" class="form-control" placeholder="Left item">
                                <input type="text" name="match_right[]" class="form-control" placeholder="Right item">
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="addMatchingPair()">Add More Pairs</button>
                    </div>
                </div>
    
                <!-- Numerical Answer Options -->
                <div id="numericalOptions" style="display: none;" class="mb-3">
                    <div class="form-group">
                        <label>Correct Answer:</label>
                        <input type="number" name="numerical_answer" class="form-control" step="any">
                        <label>Acceptable Error Margin (Â±):</label>
                        <input type="number" name="error_margin" class="form-control" step="any" placeholder="e.g., 0.1">
                    </div>
                </div>
    
                <!-- Short Answer Options -->
                <div id="shortAnswerOptions" style="display: none;" class="mb-3">
                    <div class="form-group">
                        <label>Model Answer:</label>
                        <textarea name="short_answer" class="form-control" rows="3"></textarea>
                        <small class="text-muted">This will be used as a reference for grading</small>
                    </div>
                </div>
    
                <!-- Essay Options -->
                <div id="essayOptions" style="display: none;" class="mb-3">
                    <div class="form-group">
                        <label>Grading Rubric:</label>
                        <textarea name="essay_rubric" class="form-control" rows="3" placeholder="Enter grading criteria"></textarea>
                        <label>Word Limit:</label>
                        <input type="number" name="word_limit" class="form-control" placeholder="Maximum word count">
                    </div>
                </div>
    
                <div class="row mb-3">
                    <div class="col-md-4">
                        <input type="text" name="subject" class="form-control" placeholder="Subject" required>
                    </div>
                    <div class="col-md-4">
                        <input type="text" name="topic" class="form-control" placeholder="Topic" required>
                    </div>
                    <div class="col-md-4">
                        <select name="difficulty" class="form-control" required>
                            <option value="">Select Difficulty</option>
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                </div>
    
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Add Question</button>
                    <a href="{% url 'questions_list' %}" class="btn btn-secondary ml-2">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .question-form {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .option-group {
        margin-bottom: 15px;
    }
    .matching-pair {
        margin-bottom: 10px;
    }
    /* Remove this block */
    /* .ql-editor {
        min-height: 150px;
    } */
    .nav-tabs .nav-link {
        color: #495057;
        cursor: pointer;
    }
    .nav-tabs .nav-link.active {
        font-weight: bold;
    }
    .tab-content {
        padding-top: 20px;
    }
</style>

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Keep only the toggle and matching pair functions
function toggleAnswerFields() {
    const questionType = document.getElementById('questionType').value;
    const allOptions = [
        'multipleChoiceOptions',
        'trueFalseOptions',
        'fillBlanksOptions',
        'matchingOptions',
        'numericalOptions',
        'shortAnswerOptions',
        'essayOptions'
    ];

    // Hide all option divs
    allOptions.forEach(option => {
        document.getElementById(option).style.display = 'none';
    });

    // Show the selected option div
    switch(questionType) {
        case 'multiple_choice':
            document.getElementById('multipleChoiceOptions').style.display = 'block';
            break;
        case 'true_false':
            document.getElementById('trueFalseOptions').style.display = 'block';
            break;
        case 'fill_blanks':
            document.getElementById('fillBlanksOptions').style.display = 'block';
            break;
        case 'matching':
            document.getElementById('matchingOptions').style.display = 'block';
            break;
        case 'numerical':
            document.getElementById('numericalOptions').style.display = 'block';
            break;
        case 'short_answer':
            document.getElementById('shortAnswerOptions').style.display = 'block';
            break;
        case 'essay':
            document.getElementById('essayOptions').style.display = 'block';
            break;
    }
}

function addMatchingPair() {
    const matchingPairs = document.getElementById('matchingPairs');
    const newPair = document.createElement('div');
    newPair.className = 'matching-pair input-group mb-2';
    newPair.innerHTML = `
        <input type="text" name="match_left[]" class="form-control" placeholder="Left item">
        <input type="text" name="match_right[]" class="form-control" placeholder="Right item">
        <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">Remove</button>
    `;
    matchingPairs.appendChild(newPair);
}
</script>
{% endblock %}
{% endblock %}

